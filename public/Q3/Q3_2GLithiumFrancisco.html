<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Noah Connor C. Francisco">
    <title>Club Application Form</title>
    <link rel="icon" type="image/jpg" href="../assets/430-4305671_pshs-logo-philippine-science-high-school-logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css.css">
</head>
<body>

<h1>Club Application</h1>
<h2>Join the Different Organizations!</h2>

<form id="clubForm">
    <fieldset>
        <legend>Student Information</legend>
        <label>Student ID: <input type="number" id="studentID" required onblur="checkEmpty(this)"></label>
        <label>Full Name: <input type="text" id="fullName" required onblur="checkEmpty(this)"></label>
        <label>Birthday: <input type="date" id="birthday" required></label>
        <label>Email Address: <input type="email" id="email" required onblur="checkEmpty(this)"></label>
    </fieldset>

    <fieldset>
        <legend>Membership Details</legend>
        <label>Phone Number: <input type="text" id="mobile" required onblur="checkEmpty(this)"></label>
        <label>Grade:
            <select id="grade" required>
                <option value="">-- Select Grade --</option>
                <option value="Grade 7">Grade 7</option>
                <option value="Grade 8">Grade 8</option>
                <option value="Grade 9">Grade 9</option>
                <option value="Grade 10">Grade 10</option>
                <option value="Grade 11">Grade 11</option>
                <option value="Grade 12">Grade 12</option>
            </select>
        </label>

        <label>Intern / Extern:</label>
        <div class="radio-group">
            <label><input type="radio" name="status" value="Intern" required> Intern</label>
            <label><input type="radio" name="status" value="Extern" required> Extern</label>
        </div>

        <label>Preferred Club:
            <select id="clubChoice" required>
                <option value="">-- Choose a Club --</option>
                <option value="Volant">Volant</option>
                <option value="Invictus">Invictus</option>
                <option value="MUN">MUN</option>
                <option value="AstroSoc">AstroSoc</option>
                <option value="AKSIS">AKSIS</option>
                <option value="Pallastro">Pallastro</option>
            </select>
        </label>

        <label>Why do you want to join? <textarea id="motivation" required onblur="checkEmpty(this)"></textarea></label>
    </fieldset>

    <div class="buttons">
        <button type="submit">Submit Application</button>
        <button type="reset" onclick="return confirmReset()">Reset Form</button>
        <button type="button" class="view-btn" onclick="window.location.href='viewSignUps.html'">View Signups</button>
    </div>
</form>

<script>
// This is the name used to save data in the browser
    const KEY = 'clubSignups';

    // This function gets the list of people who signed up from the browser
    function loadSignups() {
        const raw = localStorage.getItem(KEY);
        // If there is data, turn it into a list; if not, start with an empty list
        if (raw) return JSON.parse(raw);
        return [];
    }

    // This function saves the list of people back into the browser
    function saveSignups(entries) {
        localStorage.setItem(KEY, JSON.stringify(entries));
    }

    // This function checks if a box is empty when you click away from it
    function checkEmpty(element) {
        if (element.value.trim() === "") {
            element.classList.add("invalid"); // Makes the box look "bad" if empty
        } else {
            element.classList.remove("invalid"); // Makes it look normal if not empty
        }
    }

    // This function pops up a box to make sure you want to clear the form
    function confirmReset() {
        return confirm("Do you really want to reset all the form information?");
    }

    // We find the form on the page so we can watch for when it is submitted
    const clubForm = document.getElementById('clubForm');

    // This runs when you click the "Submit" button
    clubForm.onsubmit = function(event) {
        // dis stops the page from refreshing automatically
        event.preventDefault();

        // asks the user one last time if they want to join
        if (!confirm("Are you sure you want to submit your club application?")) return;

        // Collect everything the user typed into one single group
        const obj = {
            id: document.getElementById('studentID').value.trim(),
            fullname: document.getElementById('fullName').value.trim(),
            birthday: document.getElementById('birthday').value,
            email: document.getElementById('email').value.trim(),
            mobile: document.getElementById('mobile').value.trim(),
            grade: document.getElementById('grade').value,
            status: document.querySelector('input[name="status"]:checked').value,
            club: document.getElementById('clubChoice').value,
            time: new Date().toLocaleTimeString() // Saves the current time
        };

        // Get the old list of signups
        const signups = loadSignups();

        // Add the new person to that list
        signups.push(obj);

        // Save the updated list back into the browser
        saveSignups(signups);
        
        // Tell the user it worked and clear the form boxes
        alert("Application Saved Successfully.");
        clubForm.reset();
    };
</script>
</body>
</html>